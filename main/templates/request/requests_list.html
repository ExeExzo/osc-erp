{% load static %}
<!DOCTYPE html>
<html>
<head>
    <title>–ó–∞–ø—Ä–æ—Å—ã –Ω–∞ –ø–æ–∫—É–ø–∫—É</title>
    <link rel="stylesheet" href="{% static 'main/css/requests_list.css' %}">
</head>
<body>

<br>
<a href="/user/profile/">‚¨Ö –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ø—Ä–æ—Ñ–∏–ª—é</a>
<br>

<h1>üìã –ó–∞–ø—Ä–æ—Å—ã –Ω–∞ –ø–æ–∫—É–ø–∫—É</h1>

<form method="get" class="filter-form">
    <label>–§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É:</label>
    <select name="status">
        <option value="">–í—Å–µ</option>
        {% for val,label in statuses %}
            <option value="{{ val }}" {% if selected_status == val %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
    </select>
    <button type="submit">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
    {% if selected_status %}
        <a href="{% url 'requests_list' %}">–°–±—Ä–æ—Å–∏—Ç—å</a>
    {% endif %}
</form>

<div class="table-wrap">
<table class="excel-table">
    <thead>
        <tr>
            <th>–°–æ–∑–¥–∞—Ç–µ–ª—å</th>
            <th>–†–û</th>
            <th>–ü–æ—Å—Ç–∞–≤—â–∏–∫</th>
            <th>–ü–æ–∫—É–ø–∞—Ç–µ–ª—å</th>
            <th>–°—É–º–º–∞</th>
            <th>–°—Ç–∞—Ç—É—Å</th>
            <th>–î–µ–¥–ª–∞–π–Ω</th>
            <th>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th>
            <th>–ü—Ä–µ–¥–º–µ—Ç—ã</th>
            <th class="actions-col">–î–µ–π—Å—Ç–≤–∏—è</th>
        </tr>
    </thead>

    <tbody>
    {% for r in requests %}
        <tr>
            <td>{{ r.creator }}</td>
            <td><b>{{ r.ro_number }}</b></td>
            <td>{{ r.supplier }}</td>
            <td>{{ r.customer }}</td>
            <td>{{ r.amount_with_vat }}</td>
            <td><span class="status {{ r.status|lower }}">{{ r.status }}</span></td>
            <td>{{ r.ddl }}</td>
            <td class="comment">{{ r.comment }}</td>

            <td class="items">
                {% for item in r.items.all %}
                    <div>{{ item.name }} ({{ item.quantity }} √ó {{ item.price }})</div>
                {% endfor %}
            </td>

            <td class="actions">
                <a href="{% url 'change_request_status' r.id 'PAID' %}" class="btn paid">–û–ø–ª–∞—Ç–∏—Ç—å</a>
                <a href="{% url 'change_request_status' r.id 'CANCELLED' %}" class="btn cancel">–û—Ç–º–µ–Ω–∏—Ç—å</a>
            </td>
        </tr>
    {% empty %}
        <tr><td colspan="10">–ù–µ—Ç –∑–∞–ø—Ä–æ—Å–æ–≤</td></tr>
    {% endfor %}
    </tbody>
</table>
</div>

</body>
</html>
